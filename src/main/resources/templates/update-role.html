<html xmlns:th="http://www.thymeleaf.org" lang="en"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head th:replace="layout :: head">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>QUYỀN HẠN</title>
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script type="text/javascript"
	src="webjars/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="webjars/jquery/2.2.3/jquery.min.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		var urls = "/admin/vaitro/ #myModals";
		$('#model-body').html(event).load(urls);
		$('#bnn').on('click', function(event) {
			event.preventDefault();
			var url = $('#myModals').attr('action');
			$.ajax({
				contentType : "application/json",
				url : "/login/check",
				data : {
					url : url
				},
				dataType : "json",
				timeout : 10000,
				success : function(data) {
					if (data > 0) {
						$('#myModal').modal("show");

					} else {
						alert("Bạn không dùng được chức năng này");
						$('#myModal').modal("hide");
					}
				},
			});
		});

		$('.buttonDelete').on('click', function(event) {
			event.preventDefault();
			var url = $('#formDelete').attr('action');
			console.log(url);
			$.ajax({
				contentType : "application/json",
				url : "/login/check",
				data : {
					url : url
				},
				dataType : "json",
				success : function(data) {
					console.log(data);
					if (data > 0) {
						$('#myDelete').modal("show");
					} else {
						alert("Bạn không dùng được chức năng này");
						$('#myDelete').modal("hide");
					}
				},
			});
			$('#delRef').click(function() {
				$('#formDelete').submit();
			});
		});

		$('.edit').on('click', function(event) {
			event.preventDefault();
			$('input[name="vaitro"]').prop("checked", false);
			var uu = $(this).attr('href');
			var id = GetURLParameter(uu, 'id');
			$.ajax({
				contentType : "application/json",
				//			url: "/login/check",
				url : "/admin/vaitro/update",
				data : {
					id : id
				},
				dataType : "json",
				timeout : 10000,
				success : function(data) {

					console.log(data);
					$('#idUpdate').val(data.id);
					$('#mUpdate').val(data.mavaitro);
					$('#tUpdate').val(data.tenvaitro);
					var cns = getData(data.vaitros);
					if (cns != null) {
						$('input[name="vaitro"]').val(cns);
					}
					;
				}
			});
		});

	
	

	function GetURLParameter(sPageURL, sParam) {
		var sURLVariable = sPageURL.split('?');
		var sParameterName = sURLVariable[1].split('=');
		if (sParameterName[0] == sParam) {
			return sParameterName[1];
		}
	}

	function getData(data) {
		if (data == "[]") {
			return null;
		} else {
			var temp = data.substring(1, data.length - 1);
			console.log(temp);
			return temp.split(", ");
		}
	}
</script>

</head>
<body class="hold-transition skin-blue fixed sidebar-mini fuelux">
	<div class="wrapper">
		<header th:replace="layout :: header"></header>
		<aside th:replace="layout :: aside"></aside>
		<div class="content-wrapper">

			<section class="content-header">
				<h1>TRANG QUYỀN HẠN</h1>
			</section>
			<!-- Content Header (Page header) -->
			<!-- Main content -->

			<!-- /.content -->
			<div class="container main-content form">
				<div class="row">
					<!-- <h2 class="myclass">Thêm chức năng</h2> -->
					<form th:action="@{/admin/vaitro/updateVaiTro}" th:object=${VAITRO}
						method="post">

						<h2 class="myclass">Cập nhật quyền hạn</h2>



						<input type="hidden" th:field="*{id}" name="id" id="idUpdate">

						<div class="form-group">
							<label for="recipient-name" class="col-form-label">Mã vai
								trò(*):</label> <input type="text" class="form-control"
								placeholder="Nhập mã vai trò" th:field="*{mavaitro}"
								id="mUpdate">
						</div>

						<div class="form-group">
							<label for="recipient-name" class="col-form-label">Tên
								vai trò(*)</label> <input type="text" class="form-control"
								placeholder="Nhập tên vai trò" th:field="*{tenvaitro}"
								id="tUpdate">
						</div>



						<div class="form-group">
							<!-- <label for="recipient-name">Chức năng</label> -->
							<!--  <div class="">
											<select class="form-control" th:field="*{parentid}">
												<option th:each="parent : ${PARENTID}"
													th:value="${parent.id}" th:text="${parent.tenchucnang}"></option>
												<option th:value="-1">Không có</option>
											</select>
										 </div>  -->
							<div class="col-sm-10">
							<label for="recipient-name">Chức năng</label>
								<table class="table table-bordered">
									<thead>
										<tr>
											<th>Chọn</th>
											<th>Tên chức năng</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="chucnang: ${CHUCNANGS}">
											<td><input class="vt-update" type="checkbox"
												name="chucnang" th:field="*{chucnang}"
												th:value="${chucnang.id}"></td>
											<td th:text="${chucnang.tenchucnang}"></td>
										</tr>
									</tbody>
								</table>
							</div>

						</div>

						<!-- </div> -->
						<!-- <div class="modal-footer"> -->
						<button type="submit" class="btn btn-primary">Lưu</button>
						<button type="reset" class="btn btn-primary">Huỷ</button>
						<a class="btn btn-primary" href="/admin/vaitro/list">Danh sách</a>
						<!-- </div> -->
						<!-- </div>
						</div> -->

					</form>
				</div>
			</div>

		</div>
	</div>
	<footer th:replace="layout :: footer"></footer>
</body>


</html>